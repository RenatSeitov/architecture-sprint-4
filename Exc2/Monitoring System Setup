### Выбор и настройка мониторинга в системе

#### **Мотивация**

В текущей системе "Александрит" бизнес сталкивается с рядом вызовов, связанных с недостаточным мониторингом. Основные проблемы:
1. **Отсутствие полной картины данных:** После перехода к оформлению заказов через API данные Яндекс Метрики перестали отражать реальное положение дел.
2. **Невозможность быстрого реагирования на сбои:** Разрозненные логи и отсутствие централизованного мониторинга затрудняют анализ инцидентов.
3. **Риски отказов системы:** Единственные инстансы приложений и сервисов (RabbitMQ, базы данных) представляют точки отказа.

Внедрение мониторинга позволит:
- Обеспечить прозрачность работы системы для бизнеса.
- Снизить время на устранение инцидентов благодаря быстрому обнаружению и диагностике проблем.
- Оптимизировать ресурсы, выявляя узкие места.
- Улучшить пользовательский опыт за счёт стабильной работы системы.

#### **Выбор подхода к мониторингу**

Для мониторинга системы будут использоваться следующие подходы:
1. **RED (Rate, Errors, Duration):**
   - Подходит для мониторинга API и асинхронных сообщений (RabbitMQ).
   - Фокус на производительности и ошибках.

2. **Четыре золотых сигнала (Латентность, Трафик, Ошибки, Насыщенность):**
   - Используется для мониторинга приложений и инфраструктуры (EC2, базы данных, хранилище 3D файлов).

#### **Метрики и их описание**

##### **1. API и RabbitMQ (подход RED)**

- **Rate (Количество запросов/сообщений в секунду):**
  - Зачем: Позволяет понять нагрузку на API и очередь RabbitMQ.
  - Ярлыки: Приложение, метод API, статус HTTP.

- **Errors (Ошибки запросов/сообщений):**
  - Зачем: Для выявления проблем с отказами запросов или сообщений.
  - Ярлыки: Код ошибки, приложение, метод API.

- **Duration (Время выполнения запросов):**
  - Зачем: Помогает отслеживать время ответа и выявлять задержки.
  - Ярлыки: Приложение, метод API.

##### **2. Приложения (подход "Четыре золотых сигнала")**

- **Латентность:**
  - Зачем: Для анализа времени отклика приложений.
  - Ярлыки: Приложение, тип запроса.

- **Трафик:**
  - Зачем: Для понимания нагрузки на каждое приложение.
  - Ярлыки: Приложение, путь.

- **Ошибки:**
  - Зачем: Для выявления системных ошибок.
  - Ярлыки: Код ошибки, приложение.

- **Насыщенность:**
  - Зачем: Для контроля ресурсов (CPU, память).
  - Ярлыки: Приложение, окружение (dev, release, prod).

##### **3. Базы данных и хранилища (подход "Четыре золотых сигнала")**

- **Количество запросов:**
  - Зачем: Для анализа нагрузки на базу данных.
  - Ярлыки: Тип запроса (чтение/запись), приложение.

- **Время выполнения запросов:**
  - Зачем: Для диагностики медленных запросов.
  - Ярлыки: Приложение, запрос.

- **Использование дискового пространства:**
  - Зачем: Для предотвращения переполнения хранилища.
  - Ярлыки: Хранилище, приложение.

##### **4. Метрики для бизнес-анализа**

- **Конверсия заказов:**
  - Зачем: Для оценки эффективности интернет-магазина.
  - Ярлыки: Статус заказа, канал.

- **Количество загруженных 3D-файлов:**
  - Зачем: Для анализа популярности функциональности конструктора.
  - Ярлыки: Тип файла, размер файла.

#### **Обоснование выбора**

Мониторинг в соответствии с подходами RED и "Четыре золотых сигнала" обеспечивает полный охват ключевых аспектов системы:
1. RED позволяет эффективно мониторить производительность и стабильность API.
2. "Четыре золотых сигнала" идеально подходят для выявления узких мест и анализа инфраструктуры.

Для бизнеса мониторинг:
- Снизит затраты на устранение инцидентов.
- Увеличит стабильность и доступность системы.
- Даст дополнительные данные для оптимизации пользовательского опыта и роста прибыли.

